{"version":3,"sources":["../../src/components/documents-store.ts"],"sourcesContent":["import {\n  DocumentID,\n  getInternalDocumentId,\n  InternalDocumentID,\n  InternalDocumentIDStore,\n} from './internal-document-id-store.js'\nimport { Document, IDocumentsStore, OpaqueDocumentStore, Orama } from '../types.js'\n\nexport interface DocumentsStore extends OpaqueDocumentStore {\n  sharedInternalDocumentStore: InternalDocumentIDStore\n  docs: Record<InternalDocumentID, Document | undefined>\n  count: number\n}\n\nexport type DefaultDocumentsStore = IDocumentsStore<DocumentsStore>\n\nexport async function create(_: Orama, sharedInternalDocumentStore: InternalDocumentIDStore): Promise<DocumentsStore> {\n  return {\n    sharedInternalDocumentStore,\n    docs: {},\n    count: 0,\n  }\n}\n\nexport async function get(store: DocumentsStore, id: DocumentID): Promise<Document | undefined> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  return store.docs[internalId]\n}\n\nexport async function getMultiple(store: DocumentsStore, ids: DocumentID[]): Promise<(Document | undefined)[]> {\n  const found: (Document | undefined)[] = Array.from({ length: ids.length })\n\n  for (let i = 0; i < ids.length; i++) {\n    const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, ids[i])\n    found[i] = store.docs[internalId]\n  }\n\n  return found\n}\n\nexport async function getAll(store: DocumentsStore): Promise<Record<InternalDocumentID, Document>> {\n  return store.docs as Record<InternalDocumentID, Document>\n}\n\nexport async function store(store: DocumentsStore, id: DocumentID, doc: Document): Promise<boolean> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  if (typeof store.docs[internalId] !== 'undefined') {\n    return false\n  }\n\n  store.docs[internalId] = doc\n  store.count++\n\n  return true\n}\n\nexport async function remove(store: DocumentsStore, id: DocumentID): Promise<boolean> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  if (typeof store.docs[internalId] === 'undefined') {\n    return false\n  }\n\n  delete store.docs[internalId]\n  store.count--\n\n  return true\n}\n\nexport async function count(store: DocumentsStore): Promise<number> {\n  return store.count\n}\n\nexport async function load<R = unknown>(\n  sharedInternalDocumentStore: InternalDocumentIDStore,\n  raw: R,\n): Promise<DocumentsStore> {\n  const rawDocument = raw as DocumentsStore\n\n  return {\n    docs: rawDocument.docs,\n    count: rawDocument.count,\n    sharedInternalDocumentStore,\n  }\n}\n\nexport async function save<R = unknown>(store: DocumentsStore): Promise<R> {\n  return {\n    docs: store.docs,\n    count: store.count,\n  } as R\n}\n\nexport async function createDocumentsStore(): Promise<DefaultDocumentsStore> {\n  return {\n    create,\n    get,\n    getMultiple,\n    getAll,\n    store,\n    remove,\n    count,\n    load,\n    save,\n  }\n}\n"],"names":["getInternalDocumentId","create","_","sharedInternalDocumentStore","docs","count","get","store","id","internalId","getMultiple","ids","found","Array","from","length","i","getAll","doc","remove","load","raw","rawDocument","save","createDocumentsStore"],"mappings":"AAAA,SAEEA,qBAAqB,QAGhB,kCAAiC;AAWxC,OAAO,eAAeC,OAAOC,CAAQ,EAAEC,2BAAoD,EAA2B;IACpH,OAAO;QACLA;QACAC,MAAM,CAAC;QACPC,OAAO;IACT;AACF,CAAC;AAED,OAAO,eAAeC,IAAIC,KAAqB,EAAEC,EAAc,EAAiC;IAC9F,MAAMC,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,OAAOD,MAAMH,IAAI,CAACK,WAAW;AAC/B,CAAC;AAED,OAAO,eAAeC,YAAYH,KAAqB,EAAEI,GAAiB,EAAqC;IAC7G,MAAMC,QAAkCC,MAAMC,IAAI,CAAC;QAAEC,QAAQJ,IAAII,MAAM;IAAC;IAExE,IAAK,IAAIC,IAAI,GAAGA,IAAIL,IAAII,MAAM,EAAEC,IAAK;QACnC,MAAMP,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEQ,GAAG,CAACK,EAAE;QAClFJ,KAAK,CAACI,EAAE,GAAGT,MAAMH,IAAI,CAACK,WAAW;IACnC;IAEA,OAAOG;AACT,CAAC;AAED,OAAO,eAAeK,OAAOV,KAAqB,EAAiD;IACjG,OAAOA,MAAMH,IAAI;AACnB,CAAC;AAED,OAAO,eAAeG,MAAMA,KAAqB,EAAEC,EAAc,EAAEU,GAAa,EAAoB;IAClG,MAAMT,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,IAAI,OAAOD,MAAMH,IAAI,CAACK,WAAW,KAAK,aAAa;QACjD,OAAO,KAAK;IACd,CAAC;IAEDF,MAAMH,IAAI,CAACK,WAAW,GAAGS;IACzBX,MAAMF,KAAK;IAEX,OAAO,IAAI;AACb,CAAC;AAED,OAAO,eAAec,OAAOZ,KAAqB,EAAEC,EAAc,EAAoB;IACpF,MAAMC,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,IAAI,OAAOD,MAAMH,IAAI,CAACK,WAAW,KAAK,aAAa;QACjD,OAAO,KAAK;IACd,CAAC;IAED,OAAOF,MAAMH,IAAI,CAACK,WAAW;IAC7BF,MAAMF,KAAK;IAEX,OAAO,IAAI;AACb,CAAC;AAED,OAAO,eAAeA,MAAME,KAAqB,EAAmB;IAClE,OAAOA,MAAMF,KAAK;AACpB,CAAC;AAED,OAAO,eAAee,KACpBjB,2BAAoD,EACpDkB,GAAM,EACmB;IACzB,MAAMC,cAAcD;IAEpB,OAAO;QACLjB,MAAMkB,YAAYlB,IAAI;QACtBC,OAAOiB,YAAYjB,KAAK;QACxBF;IACF;AACF,CAAC;AAED,OAAO,eAAeoB,KAAkBhB,KAAqB,EAAc;IACzE,OAAO;QACLH,MAAMG,MAAMH,IAAI;QAChBC,OAAOE,MAAMF,KAAK;IACpB;AACF,CAAC;AAED,OAAO,eAAemB,uBAAuD;IAC3E,OAAO;QACLvB;QACAK;QACAI;QACAO;QACAV;QACAY;QACAd;QACAe;QACAG;IACF;AACF,CAAC"}